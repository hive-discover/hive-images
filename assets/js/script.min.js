const API_ADDRESS="https://api.hive-discover.tech/v1/",LBP_API_ADDRESS="https://lbp-api.hive-discover.tech/",blocked_urls=["https://files.peakd.com/file/peakd-hive/ridor5301/245cyhmmwFDnV4yecfPyUyx3YJv9iNwTkpUXajj584WdwFtdRGyQL7dc55JnJ4a67UQRH.jpg","https://images.hive.blog/DQmNWT3pij1jZRAH8cdLathMLxkAeCBYESj8oKscYS786jW/Line HIve.png","https://images.hive.blog/DQmWNkFtbpcrjeLjgQhCGCJPJ8fxnZdJ2jjZyAxDYW5zLsg/IMG_20210920_155748.jpg"];function OnClick_CloseIframe(){const e=JSON.stringify({msg:"close-iframe",date:Date.now(),data:{}});window.parent.postMessage(e,"*")}async function loadMuteList(){document.getElementById("btn_load_mute_list").style.display="none";const e=await fetch(API_ADDRESS+"/images/mute-list").then(e=>e.json()).catch(e=>{console.error(e)});if(!e||!e.result||"ok"===!e.status)return alert("Something went wrong"),void(document.getElementById("btn_load_mute_list").style.display="");document.getElementById("lbl_mute_list_title").style.display="",document.getElementById("muted-accounts-container").style.display="",document.getElementById("muted-posts-container").style.display="",document.getElementById("mute-list-section").style.background="",e.result.forEach(e=>{"acc"===e.type&&(document.getElementById("muted-accounts-container").innerHTML+=`\n                <div class="col col-md-2 text-center">\n                    <h6 style="margin: 0px;padding: 0px;">Account</h6>\n                    <p>@${e._id}</p>\n                </div>\n            `),"post"===e.type&&(document.getElementById("muted-posts-container").innerHTML+=`\n                <div class="col col-md-3 text-center">\n                    <h6 style="margin: 0px;padding: 0px;">@${e.author}</h6>\n                    <p>${e.permlink}</p>\n                    <a href="https://peakd.com/@${e.author}/${e.permlink}" target="_blank" style="color: blue">View Full Post</a>\n                </div>\n            `)})}async function clearPostInfoForm(){document.getElementById("txt_viewinfo_author").value="",document.getElementById("txt_viewinfo_permlink").value="",document.getElementById("post-info-results-container").style.display="none",document.getElementById("post-info-result-images").innerHTML=""}async function onClickPostInfoSearch(){const e=document.getElementById("txt_viewinfo_author").value.replace("@",""),t=document.getElementById("txt_viewinfo_permlink").value.replace("/","");if(!e||e.length<=3||!t||t.length<=3)return void alert("Please enter a valid author and permlink");const a=await fetch(`https://api.hive-discover.tech/v1//images/post-info?author=${e}&permlink=${t}`).then(e=>e.json()).catch(e=>{console.error(e)});if(!a||"ok"===!a.status)return void alert("Failed: "+a.err);const{author:n,permlink:s,tags:l,images:o}=a.result;document.getElementById("post-info-results-container").style.display="block",document.getElementById("label_post_info_author").innerHTML=n,document.getElementById("label_post_info_permlink").innerHTML=s,document.getElementById("label_post_info_tags").innerHTML=l,document.getElementById("label_post_info_tags").innerHTML.length<5&&(document.getElementById("label_post_info_tags").innerHTML="no tags available"),document.getElementById("post-info-result-images").innerHTML="",o.forEach(e=>{const t=`\n        <div class="col col-md-9" style="\n            background-image: url('${e}');\n            background-position: center;\n            background-size: cover;\n            width: 100%;\n            background-repeat: no-repeat;\n            min-height: 250px;">\n        </div>\n        <div class="col d-xl-flex justify-content-xl-center col-md-3">\n            <a class="d-xl-flex align-items-xl-center" href="${e}" target="_blank">\n                View Full Image\n            </a>\n        </div>\n        `;document.getElementById("post-info-result-images").innerHTML+=t})}async function onClickMutePost(){const e=document.getElementById("txt_mutepost_author").value.replace("@",""),t=document.getElementById("txt_mutepost_permlink").value.replace("/",""),a=document.getElementById("txt_mod_passwd").value;if(!e||e.length<=3||!t||t.length<=3|!a||a.length<=3)return void alert("Please enter a valid author, permlink and password");const n=await fetch(`https://api.hive-discover.tech/v1//images/mute-post?author=${e}&permlink=${t}&password=${a}`).then(e=>e.json()).catch(e=>{console.error(e)});n||alert("Something unknown went wrong"),"ok"===n.status&&(alert("Ok: Post is muted"),location.reload()),"failed"===n.status&&alert("Failed: "+n.err)}$().ready(()=>{$("#btn_search_topics").click(OnClick_SearchByTopic),$("#btn_search_img_url").click(OnClick_SearchByURL),$("#btn_search_uploaded").click(OnClick_SearchByIMG),$("#btn-copy-image-url").click(OnClick_CopyImageURL),$("#btn-search-usage").click(getUsageData),$("#btn-close-all-modals").click(closeAllModals),$("#btn-close-iframe").click(OnClick_CloseIframe),document.getElementById("txt_search_img_url")&&document.getElementById("txt_search_img_url").addEventListener("keyup",e=>{13===e.keyCode&&(e.preventDefault(),OnClick_SearchByURL())}),document.getElementById("txt_search_topics")&&document.getElementById("txt_search_topics").addEventListener("keyup",e=>{13===e.keyCode&&(e.preventDefault(),OnClick_SearchByTopic())}),document.getElementById("txt_usage_username")&&document.getElementById("txt_usage_username").addEventListener("keyup",e=>{13===e.keyCode&&(e.preventDefault(),getUsageData())}),$("#image-modal").on("hidden.bs.modal",onCloseExandImageModal);const e=new URLSearchParams(window.location.search);e.get("q")&&($("#txt_search_topics").val(e.get("q")),$("#btn_search_topics").click()),"false"==e.get("enableCloseIframe")&&$("#btn-close-iframe").hide()});let all_images={},modal_images=[],post_img_modal_stack=[];String.prototype.hashCode=function(){for(var e=0,t=0,a=this.length;t<a;)e=(e<<5)-e+this.charCodeAt(t++)<<0;return e};const removeSkeletonLoaderClass=()=>{console.log("gdfg"),jQuery(this).removeClass("big-skeleton-loading")},closeAllModals=()=>{post_img_modal_stack=[],$("#image-modal").modal("hide"),$("#image-expand").modal("hide")},OnClick_CopyImageURL=()=>{var e=document.getElementById("expand-image-label-url");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value);const t=document.getElementById("exand-image-author").value.replace("@",""),a=document.getElementById("exand-image-permlink").value;for(let n of Object.keys(all_images)){const s=all_images[n];if(s.author!==t||s.permlink!==a)continue;const l=JSON.stringify({msg:"image-choosen",date:Date.now(),selected:e.value,...Object.fromEntries(Object.entries(s).filter(([e,t])=>!["imgs","images","sim_url","title"].includes(e)))});window.parent.postMessage(l,"*");break}},clearSearch=()=>{all_images={},$("#container-search-results").empty(),document.getElementById("search_img_error").style.display="none",document.getElementById("section-search-results").style.display="block",document.getElementById("label-no-results").style.display="none",document.getElementById("search-loading-spinner").style.display="block",document.getElementById("container-search-inputs").style.minHeight="",$("html, body").animate({scrollTop:$("#hr-search-licence").offset().top-($("#mainNav").height()||0)},500)},loadSimilarImagesToExanded=async e=>{document.getElementById("modal-image-sim-container").innerHTML="",document.getElementById("image-expand-sim-label").style.display="none";const t=await fetch(API_ADDRESS+"/images/similar-url?url="+e,{method:"GET"}).then(async e=>await e.json()).catch(e=>(console.error(e),null));if(t&&"ok"===t.status&&t.sim_objs){t.sim_objs.length&&(document.getElementById("image-expand-sim-label").style.display="block");for(let e=0;e<t.sim_objs.length;e++){let a=t.sim_objs[e];a.imgs=a.images,all_images[a.imgs[0].hashCode()]||(all_images[a.imgs[0].hashCode()]=a);const n=`\n            <div class="col-md-6 col-lg-4">\n                <a class="d-block mx-auto portfolio-item" href="javascript:showImageModal('${a.imgs[0].hashCode()}');">\n                    <div class="d-flex portfolio-item-caption position-absolute h-100 w-100">\n                        <div class="text-center text-white my-auto portfolio-item-caption-content w-100">\n                            <i class="fa fa-search-plus fa-3x"></i>\n                        </div>\n                    </div>\n    \n                    <img class="img-fluid big-skeleton-loading stock-image" onload="jQuery(this).removeClass('big-skeleton-loading');" src="${a.sim_url}" loading="lazy"/>\n                    <p style="float: right;">by <small>@${a.author}</small></p>\n                    </a>\n            </div>\n        `;document.getElementById("modal-image-sim-container").innerHTML+=n}}else $("#modal-something-went-wrong").modal("show")},expandImage=(e,t,a)=>{document.getElementById("expand-image-url").src="placeholder.png",document.getElementById("expand-image-url").src=e,document.getElementById("expand-image-label-url").value=e,document.getElementById("exand-image-permlink").value=a,document.getElementById("exand-image-author").value="@"+t,$("#image-expand").modal("show"),loadSimilarImagesToExanded(e)},onCloseExandImageModal=()=>{if(!post_img_modal_stack.length)return;const e=post_img_modal_stack.pop(),t=all_images[e];if(document.getElementById("modal-title").innerText==='"'+t.title+'"'&&document.getElementById("modal-author").innerText==="by @"+t.author)return onCloseExandImageModal();showImageModal(e,!1)},showImageModal=(e,t=!0)=>{const a=all_images[e];modal_images=[],$("#modal-title").text('"'+a.title+'"'),$("#modal-author").text("by @"+a.author),document.getElementById("image-modal-peakd-link").href="https://peakd.com/@"+a.author+"/"+a.permlink,document.getElementById("container-post-images").innerHTML="",document.getElementById("modal-loader").style.display="block",$("#image-modal").modal("show"),$("#image-expand").modal("hide");for(let e=0;e<a.imgs.length;e++){const t=`\n            <div class="col-md-6 col-lg-4" style="margin: auto">\n                <a class="d-block mx-auto portfolio-item" href="javascript:expandImage('${a.imgs[e]}', '${a.author}', '${a.permlink}');">\n                    <div class="d-flex portfolio-item-caption position-absolute h-100 w-100">\n                        <div class="text-center text-white my-auto portfolio-item-caption-content w-100">\n                            <i class="fa fa-expand"></i>\n                        </div>\n                    </div>\n                    <img class="img-fluid big-skeleton-loading stock-image" onload="jQuery(this).removeClass('big-skeleton-loading');" src="${a.imgs[e]}" loading="lazy" />\n                    </div>\n                </a>\n            </div>\n        `;modal_images.push(a.imgs[e]),$("#container-post-images").append(t)}document.getElementById("modal-loader").style.display="none",t&&post_img_modal_stack.push(e)},addOneImage=(e,t="container-search-results")=>{const a=all_images[e],n=`\n        <div class="col-md-6 col-lg-4">\n            <a class="d-block mx-auto portfolio-item" href="javascript:showImageModal('${e}');">\n                <div class="d-flex portfolio-item-caption position-absolute h-100 w-100">\n                    <div class="text-center text-white my-auto portfolio-item-caption-content w-100">\n                        <i class="fa fa-search-plus fa-3x"></i>\n                    </div>\n                </div>\n\n                <img \n                    class="img-fluid big-skeleton-loading stock-image" \n                    onload="jQuery(this).removeClass('big-skeleton-loading');" \n                    onerror="this.src = all_images['${e}'].imgs.shift();"\n                    src="${a.imgs[0]}"  \n                    loading="lazy" \n                />\n                <p style="float: right;">by <small>@${a.author}</small></p>\n                </a>\n        </div>\n    `;$("#"+t).append(n)},addOnePost=async(e,t="container-search-results")=>{e&&(e.images=e.images.filter(e=>"string"==typeof e),all_images[e.images[0].hashCode()]={author:e.author,permlink:e.permlink,title:e.title,imgs:e.images.filter(e=>!blocked_urls.includes(e))},addOneImage(e.images[0].hashCode(),t))},loadResults=async(e,t=15)=>{if(!e||0===e.length)return document.getElementById("search-loading-spinner").style.display="none",document.getElementById("btn-load-more-images").style.display="none",void(document.getElementById("label-no-results").style.display="block");for(let a=0;e.length,a<t;a++)await addOnePost(e.shift());document.getElementById("search-loading-spinner").style.display="none",e.length>0?document.getElementById("btn-load-more-images").style.display="block":document.getElementById("btn-load-more-images").style.display="none",$("#btn-load-more-images").click(async a=>{a.preventDefault(),document.getElementById("btn-load-more-images").style.display="none",document.getElementById("search-loading-spinner").style.display="block";for(let a=0;e.length,a<t;a++)await addOnePost(e.shift());e.length>0&&(document.getElementById("btn-load-more-images").style.display="block"),document.getElementById("search-loading-spinner").style.display="none"})},getTextSearchAPIData=async(e,t=100)=>{const a={query:e,amount:t,full_data:!0,sorting:"smart"},n=await new Promise((e,t)=>{$.ajax({url:API_ADDRESS+"images/text",contentType:"application/json;charset=UTF-8",method:"POST",data:JSON.stringify(a),success:function(t){e(t)},error:function(e){t(e)}})});if(!n||"ok"!==n.status||!n.posts)return console.error(error),document.getElementById("label-no-results").style.display="block",document.getElementById("search-loading-spinner").style.display="none",void $("#modal-something-went-wrong").modal("show");await loadResults(n.posts)},getSimilarSearchAPIData=async(e,t=100)=>{const a={img_desc:e,amount:t,full_data:!0},n=await new Promise((e,t)=>{$.ajax({url:API_ADDRESS+"/images/similar",contentType:"application/json;charset=UTF-8",method:"POST",data:JSON.stringify(a),success:function(t){e(t)},error:function(e){t(e)}})});if(!n||"ok"!==n.status||!n.posts)return console.error(error),document.getElementById("label-no-results").style.display="block",document.getElementById("search-loading-spinner").style.display="none",void $("#modal-something-went-wrong").modal("show");await loadResults(n.posts)},OnClick_SearchByIMG=async()=>{if(0==document.getElementById("upload").files.length)return;clearSearch(),form=new FormData,form.append("file",document.getElementById("upload").files[0]);let e=await fetch(LBP_API_ADDRESS+"img",{method:"POST",body:form}).catch(e=>{console.error(e)});if(void 0===e||200!==e.status)return document.getElementById("label-no-results").style.display="block",document.getElementById("search-loading-spinner").style.display="none",void $("#modal-something-went-wrong").modal("show");let t=await e.json();await getSimilarSearchAPIData(t.description)},OnClick_SearchByURL=async()=>{const e=$("#txt_search_img_url").val();0!=e.length?(clearSearch(),document.getElementById("img_search_url").onload=async()=>{let t=await fetch(LBP_API_ADDRESS+"url?img_url="+e,{method:"POST"}).catch(e=>{console.error(e)});if(void 0===t||200!==t.status)return document.getElementById("label-no-results").style.display="block",document.getElementById("search-loading-spinner").style.display="none",void $("#modal-something-went-wrong").modal("show");let a=await t.json();await getSimilarSearchAPIData(a.description)},document.getElementById("img_search_url").onerror=()=>{document.getElementById("search_img_error").style.display="block",document.getElementById("label-no-results").style.display="block",document.getElementById("search-loading-spinner").style.display="none",document.getElementById("img_search_url").onload=null,document.getElementById("img_search_url").src=""},document.getElementById("img_search_url").src=e):document.getElementById("label-no-results").style.display="block"},OnClick_SearchByTopic=async()=>{const e=$("#txt_search_topics").val();0!=e.length?(clearSearch(),await getTextSearchAPIData(e)):document.getElementById("label-no-results").style.display="block"};let usage_modal_data={};const clearUsageModal=()=>{document.getElementById("container-usage-posts").innerHTML="",document.getElementById("usage-nothing-was-found").style.display="",document.getElementById("usage-loader").style.display="none",document.getElementById("btn-usage-load-more").style.display="none",usage_modal_data={}},addOneUsagePost=e=>{const t="https://peakd.com/@"+e.author+"/"+e.permlink,a='\n        <div class="col col-md-12" style="margin-bottom: 20px">\n            <div class="row">\n                <div class="col col-md-3"><img class="col-md-12" loading="lazy" src="'+e.images[0]+'" /></div>\n                <div class="col col-md-9" style="margin: auto;">\n                    <h3>\n                        '+e.title+'\n                        <small>\n                            - @<a href="https://peakd.com/@'+e.author+'" target="_blank">'+e.author+'</a>\n                        </small>\n                    </h3><a href="'+t+'" target="_blank" style>Read it on PeakD</a>\n                </div>\n            </div>\n            <hr/>\n        </div>      \n    ';document.getElementById("container-usage-posts").innerHTML+=a},showSomeUsagePosts=(e=7)=>{document.getElementById("usage-loader").style.display="";let t=0;for(;usage_modal_data.remaining_posts&&usage_modal_data.remaining_posts.length>0&&t<e;)t+=1,addOneUsagePost(usage_modal_data.remaining_posts.shift());document.getElementById("usage-loader").style.display="none",usage_modal_data.remaining_posts&&0!==usage_modal_data.remaining_posts.length?document.getElementById("btn-usage-load-more").style.display="":document.getElementById("btn-usage-load-more").style.display="none"},getUsageData=async()=>{clearUsageModal();const e=$("#txt_usage_username").val();if(e.length<2)return void alert("Please enter an username");document.getElementById("usage-nothing-was-found").style.display="none",document.getElementById("usage-loader").style.display="";let t=await fetch(API_ADDRESS+"images/used?username="+e,{method:"GET"}).catch(e=>{console.error(e)});return void 0===t||200!==t.status?($("#modal-something-went-wrong").modal("show"),void clearUsageModal()):(usage_modal_data.remaining_posts=(await t.json()).posts,0===usage_modal_data.remaining_posts.length?(clearUsageModal(),void(document.getElementById("usage-nothing-was-found").style.display="")):void showSomeUsagePosts())};function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){$("#imageResult").attr("src",e.target.result)},t.readAsDataURL(e.files[0])}}!function(e){"use strict";e('a.js-scroll-trigger[href*="#"]:not([href="#"])').click((function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=e(this.hash);if((t=t.length?t:e("[name="+this.hash.slice(1)+"]")).length)return e("html, body").animate({scrollTop:t.offset().top-70},1e3,"easeInOutExpo"),!1}})),e(document).scroll((function(){e(this).scrollTop()>100?e(".scroll-to-top").fadeIn():e(".scroll-to-top").fadeOut()})),e(".js-scroll-trigger").click((function(){e(".navbar-collapse").collapse("hide")})),e("body").scrollspy({target:"#mainNav",offset:80});var t=function(){e("#mainNav").offset()&&(e("#mainNav").offset().top>100?e("#mainNav").addClass("navbar-shrink"):e("#mainNav").removeClass("navbar-shrink"))};t(),e(window).scroll(t),e((function(){e("body").on("input propertychange",".floating-label-form-group",(function(t){e(this).toggleClass("floating-label-form-group-with-value",!!e(t.target).val())})).on("focus",".floating-label-form-group",(function(){e(this).addClass("floating-label-form-group-with-focus")})).on("blur",".floating-label-form-group",(function(){e(this).removeClass("floating-label-form-group-with-focus")}))}))}(jQuery),$((function(){$("#upload").on("change",(function(){readURL(input)}))}));var input=document.getElementById("upload"),infoArea=document.getElementById("upload-label");function showFileName(e){var t=e.srcElement.files[0].name;infoArea.textContent="File name: "+t}input.addEventListener("change",showFileName),jQuery(document).ready((function(e){var t,a;function n(t){var a=o(t);if(t.parents(".cd-headline").hasClass("type")){var i=t.parent(".cd-words-wrapper");i.addClass("selected").removeClass("waiting"),setTimeout((function(){i.removeClass("selected"),t.removeClass("is-visible").addClass("is-hidden").children("i").removeClass("in").addClass("out")}),500),setTimeout((function(){s(a,150)}),1300)}else if(t.parents(".cd-headline").hasClass("letters")){var r=t.children("i").length>=a.children("i").length;!function t(a,s,l,i){a.removeClass("in").addClass("out"),a.is(":last-child")?l&&setTimeout((function(){n(o(s))}),2500):setTimeout((function(){t(a.next(),s,l,i)}),i);if(a.is(":last-child")&&e("html").hasClass("no-csstransitions")){var r=o(s);d(s,r)}}(t.find("i").eq(0),t,r,50),l(a.find("i").eq(0),a,r,50)}else t.parents(".cd-headline").hasClass("clip")?t.parents(".cd-words-wrapper").animate({width:"2px"},600,(function(){d(t,a),s(a)})):t.parents(".cd-headline").hasClass("loading-bar")?(t.parents(".cd-words-wrapper").removeClass("is-loading"),d(t,a),setTimeout((function(){n(a)}),3800),setTimeout((function(){t.parents(".cd-words-wrapper").addClass("is-loading")}),800)):(d(t,a),setTimeout((function(){n(a)}),2500))}function s(e,t){e.parents(".cd-headline").hasClass("type")?(l(e.find("i").eq(0),e,!1,t),e.addClass("is-visible").removeClass("is-hidden")):e.parents(".cd-headline").hasClass("clip")&&e.parents(".cd-words-wrapper").animate({width:e.width()+10},600,(function(){setTimeout((function(){n(e)}),1500)}))}function l(e,t,a,s){e.addClass("in").removeClass("out"),e.is(":last-child")?(t.parents(".cd-headline").hasClass("type")&&setTimeout((function(){t.parents(".cd-words-wrapper").addClass("waiting")}),200),a||setTimeout((function(){n(t)}),2500)):setTimeout((function(){l(e.next(),t,a,s)}),s)}function o(e){return e.is(":last-child")?e.parent().children().eq(0):e.next()}function d(e,t){e.removeClass("is-visible").addClass("is-hidden"),t.removeClass("is-hidden").addClass("is-visible")}e(".cd-headline.letters").find("b").each((function(){var t=e(this),a=t.text().split(""),n=t.hasClass("is-visible");for(i in a)t.parents(".rotate-2").length>0&&(a[i]="<em>"+a[i]+"</em>"),a[i]=n?'<i class="in">'+a[i]+"</i>":"<i>"+a[i]+"</i>";var s=a.join("");t.html(s).css("opacity",1)})),t=e(".cd-headline"),a=2500,t.each((function(){var t=e(this);if(t.hasClass("loading-bar"))a=3800,setTimeout((function(){t.find(".cd-words-wrapper").addClass("is-loading")}),800);else if(t.hasClass("clip")){var s=t.find(".cd-words-wrapper"),l=s.width()+10;s.css("width",l)}else if(!t.hasClass("type")){var o=t.find(".cd-words-wrapper b"),i=0;o.each((function(){var t=e(this).width();t>i&&(i=t)})),t.find(".cd-words-wrapper").css("width",i)}setTimeout((function(){n(t.find(".is-visible").eq(0))}),a)}))}));